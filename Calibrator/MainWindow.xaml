<Window
    x:Class="Calibrator.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Calibrator.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Calibrator"
    xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
    Title="Calibrator"
    Width="1200"
    Height="800"
    Closing="Window_Closing"
    Loaded="Window_Loaded"
    SizeChanged="Window_SizeChanged"
    StateChanged="Window_StateChanged"
    WindowStartupLocation="Manual"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1*"/>
        </Grid.RowDefinitions>

        <!--  DockPanel: przyciski na górze, TabControl pod spodem  -->
        <DockPanel Grid.Row="0">
            <!--  Top Control Panel  -->
            <StackPanel
                Margin="0,0,0,10"
                VerticalAlignment="Center"
                DockPanel.Dock="Top"
                Orientation="Horizontal">
                <Button
                    x:Name="btnScanPorts"
                    Width="140"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnScanPorts_Click"
                    Content="Skanuj porty"
                    FontSize="16"/>
                <Button
                    x:Name="btnScanUSRDevices"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Blue"
                    Click="btnScanUSRDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🌐"/>
                        <TextBlock Text="Skanuj USR-N520"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnScanAllDevices"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Purple"
                    Click="btnScanAllDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🔍"/>
                        <TextBlock Text="Skanuj wszystkie"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadConfig"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadConfig_Click"
                    Content="Odczytaj konfigurację"
                    FontSize="16"/>
                <Button
                    x:Name="btnSaveCalibration"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Blue"
                    Click="btnSaveCalibration_Click"
                    Content="Zapisz"
                    FontSize="16"
                    Foreground="White"/>
                <Button
                    x:Name="btnRun"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Green"
                    Click="btnRun_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            x:Name="iconRun"
                            Margin="0,0,5,0"
                            FontSize="18"
                            Text="▶"/>
                        <TextBlock x:Name="txtRun"
                                   Text="RUN"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadWeldParams"
                    Width="240"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadWeldParams_Click"
                    Content="Odczytaj parametry zgrzewania"
                    FontSize="16"/>
                <Button
                    x:Name="btnResetStats"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Orange"
                    Click="btnResetStats_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="20"
                            Text="↺"/>
                        <TextBlock Text="Resetuj statystyki"/>
                    </StackPanel>
                </Button>
                <ComboBox
                    x:Name="comboInterval"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    VerticalContentAlignment="Center"
                    FontSize="16">
                    <ComboBoxItem
                        Content="3 x/s"
                        IsSelected="True"
                        Tag="333"/>
                    <ComboBoxItem Content="0.5 s"
                                  Tag="500"/>
                    <ComboBoxItem Content="1 s"
                                  Tag="1000"/>
                    <ComboBoxItem Content="2 s"
                                  Tag="2000"/>
                    <ComboBoxItem Content="3 s"
                                  Tag="3000"/>
                </ComboBox>
                <TextBlock
                    x:Name="txtStatus"
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="16"/>
                <Button
                    x:Name="btnToggleLogPanel"
                    Width="80"
                    Height="40"
                    Margin="10,0,0,0"
                    Click="btnToggleLogPanel_Click"
                    FontSize="16">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="📋"/>
                        <TextBlock
                            x:Name="txtToggleLogIcon"
                            FontSize="16"
                            Text="▼"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnOpenConfig"
                    Width="50"
                    Height="40"
                    Margin="5,0,0,0"
                    Click="btnOpenConfig_Click"
                    FontSize="16"
                    ToolTip="Otwórz plik konfiguracji">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,2,0"
                            FontSize="16"
                            Text="⚙"/>
                        <TextBlock FontSize="12"
                                   Text="👁"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnTcpServer"
                    Width="160"
                    Height="40"
                    Margin="5,0,0,0"
                    Click="btnTcpServer_Click"
                    Content="Uruchom serwer TCP"
                    FontSize="16"/>
            </StackPanel>

            <!--  TabControl for main content  -->
            <TabControl x:Name="mainTabControl"
                        FontSize="16">
                <!--  Tab 1: Parametry zgrzewania  -->
                <TabItem Header="Parametry zgrzewania"
                         Tag="weld_parameters">
                    <controls:WeldParametersTab x:Name="weldParametersTab"/>
                </TabItem>
                <!--  Tab 2: Parametry kalibracji  -->
                <TabItem Header="Parametry kalibracji"
                         Tag="calibration_parameters">
                    <controls:CalibrationParametersTab x:Name="calibrationParametersTab"/>
                </TabItem>
                <TabItem Header="Historia pomiarów"
                         Tag="measurement_history">
                    <controls:MeasurementHistoryTab x:Name="measurementHistoryTab"/>
                </TabItem>
                <TabItem Header="INFO"
                         Tag="info">
                    <controls:InfoTab x:Name="infoTab"/>
                </TabItem>
                <TabItem Header="Komunikacja"
                         Tag="communication">
                    <controls:CommunicationTab x:Name="communicationTab"/>
                </TabItem>
            </TabControl>
        </DockPanel>

        <!--  Splitter  -->
        <GridSplitter
            Grid.Row="1"
            Height="5"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="Transparent"
            DragCompleted="LogPanelSplitter_DragCompleted"
            ShowsPreview="True"/>

        <!--  Logger na dole  -->
        <Grid x:Name="LogPanel"
              Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <TextBox
                x:Name="txtLog"
                Grid.Row="1"
                Margin="5"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="Black"
                FontFamily="Consolas"
                FontSize="14"
                Foreground="Lime"
                HorizontalScrollBarVisibility="Auto"
                IsReadOnly="True"
                TextWrapping="NoWrap"
                VerticalScrollBarVisibility="Auto">
                <TextBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem
                            x:Name="menuClearLog"
                            Click="menuClearLog_Click"
                            Header="Wyczyść ekran"
                            ToolTip="Usuwa wszystkie wpisy z logu">
                            <MenuItem.Icon>
                                <TextBlock FontSize="14"
                                           Text="🗑"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem
                            x:Name="menuClearLogFile"
                            Click="menuClearLogFile_Click"
                            Header="Wyczyść plik LOG-u"
                            ToolTip="Usuwa cały plik logu (log.txt) z dysku">
                            <MenuItem.Icon>
                                <TextBlock FontSize="14"
                                           Text="🧹"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem
                            x:Name="menuCopyLog"
                            Click="menuCopyLog_Click"
                            Header="Kopiuj wszystko"
                            ToolTip="Kopiuje całą zawartość logu do schowka">
                            <MenuItem.Icon>
                                <TextBlock FontSize="14"
                                           Text="📋"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem
                            x:Name="menuCopySelected"
                            Click="menuCopySelected_Click"
                            Header="Kopiuj zaznaczone"
                            ToolTip="Kopiuje zaznaczony tekst do schowka">
                            <MenuItem.Icon>
                                <TextBlock FontSize="14"
                                           Text="✂"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </TextBox.ContextMenu>
            </TextBox>
        </Grid>
    </Grid>
</Window>
