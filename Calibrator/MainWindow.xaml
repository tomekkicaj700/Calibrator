<Window
    x:Class="Calibrator.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Calibrator.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Calibrator"
    xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
    Title="Calibrator"
    Width="1200"
    Height="800"
    Closing="Window_Closing"
    Loaded="Window_Loaded"
    SizeChanged="Window_SizeChanged"
    StateChanged="Window_StateChanged"
    WindowStartupLocation="Manual"
    KeyDown="Window_KeyDown"
    Focusable="True"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F0F0F0">
            <MenuItem Header="_Plik">
                <MenuItem Header="_Zapisz kalibrację" Click="btnSaveCalibration_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="💾" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Otwórz konfigurację" Click="btnOpenConfig_Click" ToolTip="Otwórz plik konfiguracji">
                    <MenuItem.Icon>
                        <TextBlock Text="⚙" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Wyjście" Click="Exit_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="✖" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Połączenie">
                <MenuItem Header="_Skanuj porty" Click="btnScanPorts_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🔌" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Skanuj _USR-N520" Click="btnScanUSRDevices_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🌐" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Skanuj _wszystkie" Click="btnScanAllDevices_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🔍" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Serwer TCP" Click="btnTcpServer_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🌐" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Kalibracja">
                <MenuItem Header="_Odczytaj konfigurację" Click="btnReadConfig_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="📖" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Parametry zgrzewania" Click="btnReadWeldParams_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="⚡" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Resetuj statystyki" Click="btnResetStats_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="↺" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Kontrola">
                <MenuItem Header="_RUN/STOP" Click="btnRun_Click">
                    <MenuItem.Icon>
                        <TextBlock x:Name="menuIconRun" Text="▶" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Interwał próbkowania">
                    <MenuItem.Icon>
                        <TextBlock Text="⏱" FontSize="16"/>
                    </MenuItem.Icon>
                    <MenuItem Header="3 x/s" Click="SetInterval_Click" Tag="333"/>
                    <MenuItem Header="0.5 s" Click="SetInterval_Click" Tag="500"/>
                    <MenuItem Header="1 s" Click="SetInterval_Click" Tag="1000"/>
                    <MenuItem Header="2 s" Click="SetInterval_Click" Tag="2000"/>
                    <MenuItem Header="3 s" Click="SetInterval_Click" Tag="3000"/>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Widok">
                <MenuItem Header="_Panel logów" Click="btnToggleLogPanel_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="📋" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Pomoc">
                <MenuItem Header="_Skróty klawiaturowe" Click="ShowKeyboardShortcuts_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="⌨" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_O programie" Click="ShowAbout_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ℹ" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!--  DockPanel: przyciski na górze, TabControl pod spodem  -->
        <DockPanel Grid.Row="1">
            <!--  Top Control Panel  -->
            <StackPanel
                Margin="0,0,0,10"
                VerticalAlignment="Center"
                DockPanel.Dock="Top"
                Orientation="Horizontal">
                <Button
                    x:Name="btnScanPorts"
                    Width="98"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnScanPorts_Click"
                    Content="Skanuj porty"
                    FontSize="16"/>
                <Button
                    x:Name="btnScanUSRDevices"
                    Width="156"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Blue"
                    Click="btnScanUSRDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🌐"/>
                        <TextBlock Text="Skanuj USR-N520"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnScanAllDevices"
                    Width="158"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Purple"
                    Click="btnScanAllDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🔍"/>
                        <TextBlock Text="Skanuj wszystkie"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadConfig"
                    Width="179"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadConfig_Click"
                    Content="Odczytaj konfigurację"
                    FontSize="16"/>
                <Button
                    x:Name="btnSaveCalibration"
                    Width="70"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Blue"
                    Click="btnSaveCalibration_Click"
                    Content="Zapisz"
                    FontSize="16"
                    Foreground="White"/>
                <Button
                    x:Name="btnRun"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Green"
                    Click="btnRun_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            x:Name="iconRun"
                            Margin="0,0,5,0"
                            FontSize="18"
                            Text="▶"/>
                        <TextBlock x:Name="txtRun"
                                   Text="RUN"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadWeldParams"
                    Width="240"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadWeldParams_Click"
                    Content="Odczytaj parametry zgrzewania"
                    FontSize="16"/>
                <Button
                    x:Name="btnResetStats"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Orange"
                    Click="btnResetStats_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="20"
                            Text="↺"/>
                        <TextBlock Text="Resetuj statystyki"/>
                    </StackPanel>
                </Button>
                <ComboBox
                    x:Name="comboInterval"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    VerticalContentAlignment="Center"
                    FontSize="16">
                    <ComboBoxItem
                        Content="3 x/s"
                        IsSelected="True"
                        Tag="333"/>
                    <ComboBoxItem Content="0.5 s"
                                  Tag="500"/>
                    <ComboBoxItem Content="1 s"
                                  Tag="1000"/>
                    <ComboBoxItem Content="2 s"
                                  Tag="2000"/>
                    <ComboBoxItem Content="3 s"
                                  Tag="3000"/>
                </ComboBox>
                <TextBlock
                    x:Name="txtStatus"
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="16"/>
                <Button
                    x:Name="btnToggleLogPanel"
                    Width="80"
                    Height="40"
                    Margin="10,0,0,0"
                    Click="btnToggleLogPanel_Click"
                    FontSize="16">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="📋"/>
                        <TextBlock
                            x:Name="txtToggleLogIcon"
                            FontSize="16"
                            Text="▼"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnOpenConfig"
                    Width="50"
                    Height="40"
                    Margin="5,0,0,0"
                    Click="btnOpenConfig_Click"
                    FontSize="16"
                    ToolTip="Otwórz plik konfiguracji">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,2,0"
                            FontSize="16"
                            Text="⚙"/>
                        <TextBlock FontSize="12"
                                   Text="👁"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnTcpServer"
                    Width="160"
                    Height="40"
                    Margin="5,0,0,0"
                    Click="btnTcpServer_Click"
                    Content="Uruchom serwer TCP"
                    FontSize="16"/>
            </StackPanel>

            <!--  TabControl for main content  -->
            <TabControl x:Name="mainTabControl"
                        FontSize="16">
                <!--  Tab 1: Parametry zgrzewania  -->
                <TabItem Tag="weld_parameters">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F1" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="Parametry zgrzewania"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:WeldParametersTab x:Name="weldParametersTab"
                                                Margin="0,0,6,0"/>
                </TabItem>
                <!--  Tab 2: Parametry kalibracji  -->
                <TabItem Tag="calibration_parameters">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F2" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="Parametry kalibracji"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:CalibrationParametersTab x:Name="calibrationParametersTab"/>
                </TabItem>
                <TabItem Tag="measurement_history">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F3" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="Historia kalibracji"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:MeasurementHistoryTab x:Name="measurementHistoryTab"/>
                </TabItem>
                <TabItem Tag="measurement_history_new">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F4" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="Historia pomiarów"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:MeasurementHistoryNewTab x:Name="measurementHistoryNewTab" Loaded="measurementHistoryNewTab_Loaded"/>
                </TabItem>
                <TabItem Tag="info">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F5" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="INFO"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:InfoTab x:Name="infoTab"/>
                </TabItem>
                <TabItem Tag="communication">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="#E0E0E0" CornerRadius="3" Padding="4,2" Margin="0,0,8,0">
                                <TextBlock Text="F6" FontSize="11" FontWeight="Bold" Foreground="#666"/>
                            </Border>
                            <TextBlock Text="Komunikacja"/>
                        </StackPanel>
                    </TabItem.Header>
                    <controls:CommunicationTab x:Name="communicationTab"/>
                </TabItem>
            </TabControl>
        </DockPanel>

        <!--  Splitter  -->
        <GridSplitter
            Grid.Row="2"
            Height="5"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="Transparent"
            DragCompleted="LogPanelSplitter_DragCompleted"
            ShowsPreview="True"/>

        <!--  Logger na dole  -->
        <controls:LogPanel x:Name="logPanel"
                           Grid.Row="3"/>

        <!--  Status Bar  -->
        <StatusBar Grid.Row="4"
                   Background="#F0F0F0">
            <StatusBarItem>
                <TextBlock x:Name="txtStatusSection0"
                           Text="Status: Gotowy"
                           FontSize="12"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtStatusSection1"
                           Text="Komendy/s: 0"
                           FontSize="12"
                           Foreground="Blue"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtStatusSection2"
                           Text="Połączenie: Brak"
                           FontSize="12"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtStatusSection3"
                           Text="Czas: 00:00:00"
                           FontSize="12"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
