<Window
    x:Class="Calibrator.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Calibrator.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Calibrator"
    xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Calibrator"
    Width="1200"
    Height="800"
    Closing="Window_Closing"
    Loaded="Window_Loaded"
    SizeChanged="Window_SizeChanged"
    StateChanged="Window_StateChanged"
    WindowStartupLocation="Manual"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1*"/>
        </Grid.RowDefinitions>

        <!--  DockPanel: przyciski na górze, TabControl pod spodem  -->
        <DockPanel Grid.Row="0">
            <!--  Top Control Panel  -->
            <StackPanel
                Margin="0,0,0,10"
                VerticalAlignment="Center"
                DockPanel.Dock="Top"
                Orientation="Horizontal">
                <Button
                    x:Name="btnScanPorts"
                    Width="140"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnScanPorts_Click"
                    Content="Skanuj porty"
                    FontSize="16"/>
                <Button
                    x:Name="btnScanUSRDevices"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Blue"
                    Click="btnScanUSRDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🌐"/>
                        <TextBlock Text="Skanuj USR-N520"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnScanAllDevices"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Purple"
                    Click="btnScanAllDevices_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="🔍"/>
                        <TextBlock Text="Skanuj wszystkie"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadConfig"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadConfig_Click"
                    Content="Odczytaj konfigurację"
                    FontSize="16"/>
                <Button
                    x:Name="btnRun"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Green"
                    Click="btnRun_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            x:Name="iconRun"
                            Margin="0,0,5,0"
                            FontSize="18"
                            Text="▶"/>
                        <TextBlock x:Name="txtRun"
                                   Text="RUN"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnReadWeldParams"
                    Width="240"
                    Height="40"
                    Margin="0,0,10,0"
                    Click="btnReadWeldParams_Click"
                    Content="Odczytaj parametry zgrzewania"
                    FontSize="16"/>
                <Button
                    x:Name="btnResetStats"
                    Width="200"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="Orange"
                    Click="btnResetStats_Click"
                    FontSize="16"
                    Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="20"
                            Text="↺"/>
                        <TextBlock Text="Resetuj statystyki"/>
                    </StackPanel>
                </Button>
                <ComboBox
                    x:Name="comboInterval"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    VerticalContentAlignment="Center"
                    FontSize="16">
                    <ComboBoxItem
                        Content="3 x/s"
                        IsSelected="True"
                        Tag="333"/>
                    <ComboBoxItem Content="0.5 s"
                                  Tag="500"/>
                    <ComboBoxItem Content="1 s"
                                  Tag="1000"/>
                    <ComboBoxItem Content="2 s"
                                  Tag="2000"/>
                    <ComboBoxItem Content="3 s"
                                  Tag="3000"/>
                </ComboBox>
                <TextBlock
                    x:Name="txtStatus"
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="16"/>
                <Button
                    x:Name="btnToggleLogPanel"
                    Width="80"
                    Height="40"
                    Margin="10,0,0,0"
                    Click="btnToggleLogPanel_Click"
                    FontSize="16">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,5,0"
                            FontSize="16"
                            Text="📋"/>
                        <TextBlock
                            x:Name="txtToggleLogIcon"
                            FontSize="16"
                            Text="▼"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="btnOpenConfig"
                    Width="50"
                    Height="40"
                    Margin="5,0,0,0"
                    Click="btnOpenConfig_Click"
                    FontSize="16"
                    ToolTip="Otwórz plik konfiguracji">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,2,0"
                            FontSize="16"
                            Text="⚙"/>
                        <TextBlock
                            FontSize="12"
                            Text="👁"/>
                    </StackPanel>
                </Button>
                <StackPanel Orientation="Horizontal"
                            Margin="0,10,0,0">
                    <TextBlock Text="IP:"
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBox x:Name="txtTcpServerIp"
                             Width="100"
                             IsReadOnly="True"
                             Text="0.0.0.0"
                             Margin="0,0,10,0"/>
                    <TextBlock Text="Port:"
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBox x:Name="txtTcpServerPort"
                             Width="70"
                             IsReadOnly="True"
                             Text="20108"
                             Margin="0,0,10,0"/>
                    <Button x:Name="btnTcpServer"
                            Content="Uruchom serwer TCP"
                            Width="160"
                            Click="btnTcpServer_Click"/>
                </StackPanel>
            </StackPanel>

            <!--  TabControl for main content  -->
            <TabControl x:Name="mainTabControl"
                        FontSize="16">
                <!--  Tab 1: Parametry zgrzewania  -->
                <TabItem Header="Parametry zgrzewania">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!--  Lewa kolumna: współczynniki kalibracji  -->
                        <GroupBox Header="Współczynniki kalibracji"
                                  Margin="0,0,20,0"
                                  Padding="10"
                                  Grid.Column="0">
                            <StackPanel>
                                <controls:VoltageCoefficients x:Name="wspZgrzewaniaVoltage"/>
                                <controls:CurrentCoefficients x:Name="wspZgrzewaniaCurrent"/>
                            </StackPanel>
                        </GroupBox>

                        <!--  Prawa kolumna: pomiary  -->
                        <Grid Grid.Column="1"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                            <GroupBox Header="Pomiary zgrzewania"
                                      Padding="10"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Stretch"
                                      MinWidth="0">
                                <Grid HorizontalAlignment="Stretch"
                                      VerticalAlignment="Stretch">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <!--  Napięcie zgrzewania  -->
                                    <StackPanel Grid.Column="0"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                Margin="0,0,20,0">
                                        <TextBlock Margin="0,0,0,10"
                                                   HorizontalAlignment="Center"
                                                   FontSize="22"
                                                   FontWeight="Bold"
                                                   Text="Napięcie zgrzewania [V]"/>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Lewa kolumna: Max/Avr/Min -->
                                            <Border Grid.Column="0"
                                                    Margin="0,0,5,10"
                                                    BorderBrush="#00BCD4"
                                                    BorderThickness="1"
                                                    CornerRadius="4">
                                                <Grid Margin="5">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Row="0"
                                                               Grid.Column="0"
                                                               Foreground="Red"
                                                               Text="Max: "/>
                                                    <TextBlock x:Name="txtNapiecieMax"
                                                               Grid.Row="0"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="Red"
                                                               Text="0000"/>
                                                    <TextBlock Grid.Row="1"
                                                               Grid.Column="0"
                                                               Foreground="Blue"
                                                               Text="Avr: "/>
                                                    <TextBlock x:Name="txtNapiecieAvr"
                                                               Grid.Row="1"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="Blue"
                                                               Text="0000"/>
                                                    <TextBlock Grid.Row="2"
                                                               Grid.Column="0"
                                                               Foreground="#4CAF50"
                                                               Text="Min: "/>
                                                    <TextBlock x:Name="txtNapiecieMin"
                                                               Grid.Row="2"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="#4CAF50"
                                                               Text="0000"/>
                                                </Grid>
                                            </Border>
                                            <!-- Prawa kolumna: ramki z wartościami -->
                                            <StackPanel Grid.Column="1"
                                                        Margin="5,0,0,0"
                                                        HorizontalAlignment="Stretch">
                                                <Border BorderBrush="#673AB7"
                                                        BorderThickness="2"
                                                        CornerRadius="4">
                                                    <TextBlock x:Name="txtNapiecieZgrzewania"
                                                               Padding="10,2"
                                                               HorizontalAlignment="Center"
                                                               FontSize="28"
                                                               FontWeight="Bold"
                                                               Foreground="#673AB7"
                                                               Text="0,07"/>
                                                </Border>
                                                <Border Margin="0,10,0,0"
                                                        BorderBrush="#2196F3"
                                                        BorderThickness="2"
                                                        CornerRadius="4">
                                                    <TextBlock x:Name="txtADCNapZgrzew"
                                                               Padding="10,2"
                                                               HorizontalAlignment="Center"
                                                               FontSize="24"
                                                               Foreground="#2196F3"
                                                               Text="31"/>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Margin="0,10,0,5"
                                                   HorizontalAlignment="Center"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Text="Woltomierz [V]"/>
                                        <lvc:Gauge x:Name="gaugeNapiecie"
                                                   Width="237"
                                                   Height="277"
                                                   Foreground="#673AB7"
                                                   Value="0.07"
                                                   From="0"
                                                   To="50"/>
                                    </StackPanel>

                                    <!--  Prąd zgrzewania  -->
                                    <StackPanel Grid.Column="1"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                Margin="20,0,0,0">
                                        <TextBlock Margin="0,0,0,10"
                                                   HorizontalAlignment="Center"
                                                   FontSize="22"
                                                   FontWeight="Bold"
                                                   Text="Prąd zgrzewania [A]"/>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Lewa kolumna: Max/Avr/Min -->
                                            <Border Grid.Column="0"
                                                    Margin="0,0,5,10"
                                                    BorderBrush="#00BCD4"
                                                    BorderThickness="1"
                                                    CornerRadius="4">
                                                <Grid Margin="5">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Row="0"
                                                               Grid.Column="0"
                                                               Foreground="Red"
                                                               Text="Max: "/>
                                                    <TextBlock x:Name="txtPradMax"
                                                               Grid.Row="0"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="Red"
                                                               Text="0000"/>
                                                    <TextBlock Grid.Row="1"
                                                               Grid.Column="0"
                                                               Foreground="Blue"
                                                               Text="Avr: "/>
                                                    <TextBlock x:Name="txtPradAvr"
                                                               Grid.Row="1"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="Blue"
                                                               Text="0000"/>
                                                    <TextBlock Grid.Row="2"
                                                               Grid.Column="0"
                                                               Foreground="#4CAF50"
                                                               Text="Min: "/>
                                                    <TextBlock x:Name="txtPradMin"
                                                               Grid.Row="2"
                                                               Grid.Column="1"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="#4CAF50"
                                                               Text="0000"/>
                                                </Grid>
                                            </Border>
                                            <!-- Prawa kolumna: ramki z wartościami -->
                                            <StackPanel Grid.Column="1"
                                                        Margin="5,0,0,0"
                                                        HorizontalAlignment="Stretch">
                                                <Border BorderBrush="#673AB7"
                                                        BorderThickness="2"
                                                        CornerRadius="4">
                                                    <TextBlock x:Name="txtPradZgrzewania"
                                                               Padding="10,2"
                                                               HorizontalAlignment="Center"
                                                               FontSize="28"
                                                               FontWeight="Bold"
                                                               Foreground="#673AB7"
                                                               Text="0,00"/>
                                                </Border>
                                                <Border Margin="0,10,0,0"
                                                        BorderBrush="#2196F3"
                                                        BorderThickness="2"
                                                        CornerRadius="4">
                                                    <TextBlock x:Name="txtADCPradZgrzew"
                                                               Padding="10,2"
                                                               HorizontalAlignment="Center"
                                                               FontSize="24"
                                                               Foreground="#2196F3"
                                                               Text="8"/>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Margin="0,10,0,5"
                                                   HorizontalAlignment="Center"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Text="Amperomierz [A]"/>
                                        <lvc:Gauge x:Name="gaugePrad"
                                                   Width="237"
                                                   Height="277"
                                                   Foreground="#E91E63"
                                                   Value="0"
                                                   From="0"
                                                   To="140"/>
                                    </StackPanel>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </Grid>
                </TabItem>
                <!--  Tab 2: Parametry kalibracji  -->
                <TabItem Header="Parametry kalibracji">
                    <Border Padding="20">
                        <TabControl x:Name="tabControlCalibration"
                                    FontSize="16">
                            <TabItem Header="Konfiguracja">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <Grid Margin="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="58*"/>
                                            <ColumnDefinition Width="126*"/>
                                            <ColumnDefinition Width="22*"/>
                                            <ColumnDefinition Width="479*"/>
                                            <ColumnDefinition Width="684*"/>
                                        </Grid.ColumnDefinitions>
                                        <!--  Left column: Kanały zgrzewarki  -->
                                        <controls:WelderChannels
                                            x:Name="welderChannels"
                                            Grid.Column="0"
                                            Grid.ColumnSpan="4"
                                            Loaded="welderChannels_Loaded"/>
                                        <!--  Right column: Wartości kanałów zgrzewarki  -->
                                        <GroupBox
                                            Grid.Column="4"
                                            Margin="10,0,0,0"
                                            FontSize="18"
                                            Header="Kanały pomiarowe napięcia i prądu zgrzewania.">
                                            <StackPanel>
                                                <controls:VoltageCoefficients x:Name="kanalyZgrzewarkiVoltage"/>
                                                <controls:CurrentCoefficients x:Name="kanalyZgrzewarkiCurrent"
                                                                              Margin="0,10,0,0"/>
                                                <!--  Przycisk Zapisz  -->
                                                <Button
                                                    x:Name="btnSaveCalibration"
                                                    Width="120"
                                                    Height="40"
                                                    Margin="0,20,0,0"
                                                    Background="Blue"
                                                    Click="btnSaveCalibration_Click"
                                                    Content="Zapisz"
                                                    FontSize="16"
                                                    Foreground="White"/>
                                            </StackPanel>
                                        </GroupBox>
                                    </Grid>
                                </ScrollViewer>
                            </TabItem>
                            <TabItem Header="Pozostałe parametry">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="341*"/>
                                            <ColumnDefinition Width="41*"/>
                                            <ColumnDefinition Width="71*"/>
                                            <ColumnDefinition Width="452*"/>
                                            <ColumnDefinition Width="452*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <!--  Column 1: Informacje o zgrzewarce, Podstawowe informacje &amp; Właściciel  -->
                                        <StackPanel
                                            Grid.Column="0"
                                            Grid.ColumnSpan="3"
                                            Margin="5,5,5,5">
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Informacje o zgrzewarce">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Status zgrzewarki:"/>
                                                    <TextBlock
                                                        x:Name="txtWelderStatus"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Port:"/>
                                                    <TextBlock
                                                        x:Name="txtPort"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Baud Rate:"/>
                                                    <TextBlock
                                                        x:Name="txtBaudRate"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Typ:"/>
                                                    <TextBlock
                                                        x:Name="txtType"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Wersja:"/>
                                                    <TextBlock
                                                        x:Name="txtVersion"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Podstawowe informacje">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Typ:"/>
                                                    <TextBlock
                                                        x:Name="txtTyp"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="KeypadSE:"/>
                                                    <TextBlock
                                                        x:Name="txtKeypadSE"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="nrJezyka:"/>
                                                    <TextBlock
                                                        x:Name="txtNrJezyka"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="NazwaZgrzewarki:"/>
                                                    <TextBlock
                                                        x:Name="txtNazwaZgrzewarki"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="NumerSeryjny:"/>
                                                    <TextBlock
                                                        x:Name="txtNumerSeryjny"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Dane właściciela">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DaneWlasciciela0:"/>
                                                    <TextBlock
                                                        x:Name="txtDaneWlasciciela0"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DaneWlasciciela1:"/>
                                                    <TextBlock
                                                        x:Name="txtDaneWlasciciela1"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DaneWlasciciela2:"/>
                                                    <TextBlock
                                                        x:Name="txtDaneWlasciciela2"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Daty">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DataSprzedazy:"/>
                                                    <TextBlock
                                                        x:Name="txtDataSprzedazy"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DataPierwszegoZgrzewu:"/>
                                                    <TextBlock
                                                        x:Name="txtDataPierwszegoZgrzewu"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="DataOstatniejKalibracji:"/>
                                                    <TextBlock
                                                        x:Name="txtDataOstatniejKalibracji"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                        </StackPanel>
                                        <!--  Column 2: Parametry techniczne &amp; Kalibracja  -->
                                        <StackPanel Grid.Column="3"
                                                    Margin="5,5,5,5">
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Parametry techniczne">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="Offset_MCP3425:"/>
                                                    <TextBlock
                                                        x:Name="txtOffsetMCP3425"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="WolneMiejsce:"/>
                                                    <TextBlock
                                                        x:Name="txtWolneMiejsce"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="LiczbaZgrzOstKalibr:"/>
                                                    <TextBlock
                                                        x:Name="txtLiczbaZgrzOstKalibr"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="OkresKalibracji:"/>
                                                    <TextBlock
                                                        x:Name="txtOkresKalibracji"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="RejestrKonfiguracji:"/>
                                                    <TextBlock
                                                        x:Name="txtRejestrKonfiguracji"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="RejestrKonfiguracjiBankTwo:"/>
                                                    <TextBlock
                                                        x:Name="txtRejestrKonfiguracjiBankTwo"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                            <GroupBox
                                                Margin="0,0,0,10"
                                                FontSize="18"
                                                Header="Kalibracja">
                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="TempOtRefVal:"/>
                                                    <TextBlock
                                                        x:Name="txtTempOtRefVal"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="TempOtRefADC:"/>
                                                    <TextBlock
                                                        x:Name="txtTempOtRefADC"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="KorekcjaTempWewn:"/>
                                                    <TextBlock
                                                        x:Name="txtKorekcjaTempWewn"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="KorekcjaTempZewn:"/>
                                                    <TextBlock
                                                        x:Name="txtKorekcjaTempZewn"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="KodBlokady:"/>
                                                    <TextBlock
                                                        x:Name="txtKodBlokady"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="TypBlokady:"/>
                                                    <TextBlock
                                                        x:Name="txtTypBlokady"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                    <TextBlock
                                                        FontSize="16"
                                                        FontWeight="Bold"
                                                        Text="GPSconfiguration:"/>
                                                    <TextBlock
                                                        x:Name="txtGPSconfiguration"
                                                        Margin="0,0,0,10"
                                                        FontSize="16"/>
                                                </StackPanel>
                                            </GroupBox>
                                        </StackPanel>
                                        <!--  Column 3: temp & CRC  -->
                                        <!--  USUNIĘTO GroupBox temp & CRC  -->
                                    </Grid>
                                </ScrollViewer>
                            </TabItem>
                        </TabControl>
                    </Border>
                </TabItem>
                <TabItem Header="Historia pomiarów">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!--  Row 0: Przyciski i filtrowanie  -->
                        <Border
                            Grid.Row="0"
                            Margin="0,0,0,10"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="4">
                            <StackPanel>
                                <!--  Przyciski akcji  -->
                                <StackPanel Margin="0,0,0,10"
                                            Orientation="Horizontal">
                                    <Button
                                        x:Name="btnRefreshHistory"
                                        Margin="0,0,10,0"
                                        Padding="10,5"
                                        Click="btnRefreshHistory_Click"
                                        Content="Odśwież"/>
                                    <Button
                                        x:Name="btnClearHistory"
                                        Margin="0,0,10,0"
                                        Padding="10,5"
                                        Click="btnClearHistory_Click"
                                        Content="Wyczyść"/>
                                    <Button
                                        x:Name="btnOpenFileHistory"
                                        Margin="0,0,10,0"
                                        Padding="10,5"
                                        Click="btnOpenFileHistory_Click"
                                        Content="Otwórz plik"/>
                                    <Button
                                        x:Name="btnToggleDetails"
                                        Padding="10,5"
                                        Click="btnToggleDetails_Click"
                                        Content="Pokaż/Ukryj szczegóły"/>
                                </StackPanel>
                                <!--  Filtrowanie  -->
                                <Border
                                    Padding="10"
                                    BorderBrush="LightGray"
                                    BorderThickness="1"
                                    CornerRadius="4">
                                    <StackPanel>
                                        <TextBlock
                                            Margin="0,0,0,5"
                                            FontWeight="Bold"
                                            Text="Filtrowanie:"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                Grid.Column="0"
                                                Margin="0,0,5,0"
                                                VerticalAlignment="Center"
                                                Text="Typ urządzenia:"/>
                                            <TextBox
                                                x:Name="txtFilterDeviceType"
                                                Grid.Column="1"
                                                Margin="0,0,10,0"
                                                TextChanged="txtFilter_TextChanged"/>
                                            <TextBlock
                                                Grid.Column="2"
                                                Margin="0,0,5,0"
                                                VerticalAlignment="Center"
                                                Text="Numer seryjny:"/>
                                            <TextBox
                                                x:Name="txtFilterSerialNumber"
                                                Grid.Column="3"
                                                Margin="0,0,10,0"
                                                TextChanged="txtFilter_TextChanged"/>
                                            <Button
                                                x:Name="btnClearFilter"
                                                Grid.Column="4"
                                                Width="100"
                                                Click="btnClearFilter_Click"
                                                Content="Wyczyść filtr"/>
                                        </Grid>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!--  Row 1: Tabela z historią  -->
                        <DataGrid
                            x:Name="dataGridHistory"
                            Grid.Row="1"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            GridLinesVisibility="All"
                            HeadersVisibility="All"
                            IsReadOnly="True"
                            MouseDoubleClick="dataGridHistory_MouseDoubleClick"
                            SelectionChanged="dataGridHistory_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Width="150"
                                    Binding="{Binding DateTime}"
                                    Header="Data i czas"/>
                                <DataGridTextColumn
                                    Width="120"
                                    Binding="{Binding DeviceType}"
                                    Header="Typ urządzenia"/>
                                <DataGridTextColumn
                                    Width="150"
                                    Binding="{Binding SerialNumber}"
                                    Header="Numer seryjny"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding MMWVH}"
                                    Header="MMWVH"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding MMWVL}"
                                    Header="MMWVL"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding IVHC_U}"
                                    Header="IVHC-U"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding IVLC_U}"
                                    Header="IVLC-U"/>
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding ADCIVHC_U}"
                                    Header="ADCIVHC-U"/>
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding ADCIVLC_U}"
                                    Header="ADCIVLC-U"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding MMWCL}"
                                    Header="MMWCL"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding MMWCH}"
                                    Header="MMWCH"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding IVHC_I}"
                                    Header="IVHC-I"/>
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding IVLC_I}"
                                    Header="IVLC-I"/>
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding ADCIVHC_I}"
                                    Header="ADCIVHC-I"/>
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding ADCIVLC_I}"
                                    Header="ADCIVLC-I"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!--  Row 2: GridSplitter  -->
                        <GridSplitter
                            Grid.Row="2"
                            Height="5"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            ShowsPreview="True"/>

                        <!--  Row 3: Panel ze szczegółami  -->
                        <Grid
                            x:Name="HistoryDetailsPanel"
                            Grid.Row="3"
                            Margin="0,10,0,0"
                            Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <controls:VoltageCoefficients
                                x:Name="historyVoltageCoefficients"
                                Grid.Column="0"
                                Margin="0,0,5,0"/>
                            <controls:CurrentCoefficients
                                x:Name="historyCurrentCoefficients"
                                Grid.Column="1"
                                Margin="5,0,0,0"/>
                        </Grid>
                    </Grid>
                </TabItem>
            </TabControl>
        </DockPanel>

        <!--  Splitter  -->
        <GridSplitter
            Grid.Row="1"
            Height="5"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="Transparent"
            DragCompleted="LogPanelSplitter_DragCompleted"
            ShowsPreview="True"/>

        <!--  Logger na dole  -->
        <Grid x:Name="LogPanel"
              Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <TextBox
                x:Name="txtLog"
                Grid.Row="1"
                Margin="5"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="Black"
                FontFamily="Consolas"
                FontSize="14"
                Foreground="Lime"
                HorizontalScrollBarVisibility="Auto"
                IsReadOnly="True"
                TextWrapping="NoWrap"
                VerticalScrollBarVisibility="Auto">
                <TextBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem
                            x:Name="menuClearLog"
                            Click="menuClearLog_Click"
                            Header="Wyczyść ekran"
                            ToolTip="Usuwa wszystkie wpisy z logu">
                            <MenuItem.Icon>
                                <TextBlock
                                    FontSize="14"
                                    Text="🗑"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem
                            x:Name="menuCopyLog"
                            Click="menuCopyLog_Click"
                            Header="Kopiuj wszystko"
                            ToolTip="Kopiuje całą zawartość logu do schowka">
                            <MenuItem.Icon>
                                <TextBlock
                                    FontSize="14"
                                    Text="📋"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem
                            x:Name="menuCopySelected"
                            Click="menuCopySelected_Click"
                            Header="Kopiuj zaznaczone"
                            ToolTip="Kopiuje zaznaczony tekst do schowka">
                            <MenuItem.Icon>
                                <TextBlock
                                    FontSize="14"
                                    Text="✂"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </TextBox.ContextMenu>
            </TextBox>
        </Grid>
    </Grid>
</Window>
